第13章.gpio外部中断概念
============================================================

前面说到按键通过扫描的方式检查按键状态,主程序循环一次就会读取一次按键的状态,这种方式实时性相对较低,对于读取像按键这类需要人的交互外设,这种延迟是感受不明显的.但是在其他的一些场景下就有些捉襟见肘.比如手环有抬手亮屏的功能,手环内的加速度传感器内置了抬手动作的识别,检测到抬手动作后输出一个GPIO中断,主控检测到GPIO中断后开始亮屏,其他时间主控则处于低功耗状态下,不用一直读取加速度计的数据.

14.1 中断与事件
-----------------------------------------------------------

假设你正在玩手机,突然有一个骚扰电话打过来,你没有管它,继续玩手机,此时就相当于一个事件,尽管你看到这个电话但是没有去处理这个事情.又比如你看到朋友打电话给你,你知道找你有事情,这时你转去接电话,接完电话后继续玩手机,此时就相当于一个中断,暂停玩手机的过程转去接电话,接完电话继续玩手机.

在stm32f103c8t6中外部中断有19个中断源,其他16个是GPIO中断,也就是全部的gpio都有外部中断的功能,16个GPIO中断是如何分到大于16个的gpio呢?stm32中将PA0、PB0...等分在中断线0上,PA1、PB1...等分在中断线1上,以此类推.也就是PA0和PB0是同一个中断线,当GPIO检测到电平变化是打断当前正在执行的程序,转而执行中断服务函数内的程序.由此明白,使用中断的方式控制按键就变为当按键按下后进入中断服务函数,执行中断服务函数的控制代码,执行完成后继续执行主程序.此时的相应速度远远大于按键扫描的方式.

事件又是怎么回事呢?从硬件上说事件是属于中断的一部分,比如按键按下后在stm32中产生了事件,如果转去执行中断服务函数的内容就是中断了,但是有时候我们不希望直接执行中断服务函数,而只是产生一个事件标志.比如有一段高低变化的电平信号,想要测量高低变化电平的时间,当电平为低时触发一个事件,定时器检测到这个事件标志开始计时知道电平变高为止,在产生一个事件标志,停止计时.这样就测量出低电平的持续时间.也就是事件作为其他中断的标志,而不直接产生中断.这种使用在后面的外部捕获中将学到.




